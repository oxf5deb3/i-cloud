@inherits System.Web.Mvc.WebViewPage
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section HeaderStyle{
    <style type="text/css">
        body {
            font-size: 12px;
        }

        .textbox, .textbox-text {
            -moz-border-radius: 2px 2px 2px 2px;
            -webkit-border-radius: 2px 2px 2px 2px;
            border-radius: 2px 2px 2px 2px;
        }

        .form-horizontal .form-group {
            margin-left: 0px;
            margin-right: 0px;
        }

        .form-group {
            margin-bottom: 5px;
        }

        .red-star {
            color: red;
            font-size: 15px;
        }
    </style>
}

<div class="q-condition">
    <div class="btn-container">
        <a href="#" id="btnQuery" class="easyui-linkbutton" data-options="iconCls:'icon-search'" style="width:80px">查询</a>
        <a href="#" id="btnPrint" class="easyui-linkbutton" data-options="iconCls:'icon-print'" style="width:80px">打印</a>
    </div>
    <hr />
    <table>
        <tr>
            <td style="width:250px;"> 驾驶证编号：<input class="easyui-textbox" id="id_no" style="width:150px"></td>
            <td style="width:250px;">姓名：<input class="easyui-textbox" id="name" style="width:150px"></td>
            <td style="width:250px;">车牌号码：<input class="easyui-textbox" id="car_number" style="width:150px"></td>
            <td style ="width:250px;">准驾车型：<input id="car_type" style="width:150px"></td>
            <td style="width:100%"></td>

        </tr>
        
    </table>
</div>
<hr />
<div class="q-detail">
    <table id="dgDetail"></table>
</div>
<div id="print" style="display:none;"></div>
<div id="bb" style="display:none;">
    <a href="#" class="easyui-linkbutton c5" style="width:60px" onclick="print()" data-options="plain:true">打印</a>
    <a href="#" class="easyui-linkbutton c2" style="width:60px" onclick="cancelPrint()" data-options="plain:true">取消</a>
</div>
@section scripts{
    <script type="text/javascript">
         function print(){
       var body = $('#print').dialog('body');
       var oWin = window.open("", "_blank");
        oWin.document.write(body.find("#content").html());
        oWin.focus();
        oWin.document.close();
        oWin.print();
        //oWin.close();
        return false;
    }
    function cancelPrint(){
      $('#print').dialog('close');
    }
        function getQueryParams() {
            var params = {};
            var id_no = $('#id_no').textbox('getValue');
            var name = $('#name').textbox('getValue');
            var permitted_card_type = $('#car_type').combobox('getValue');
            params.id_no = id_no;
            params.name = name;
            params.permitted_car_type_no = permitted_card_type;


            return params;
        }
         function initPrint(){
            $('#print').dialog({
                    width:430,
                    height:450,
                    noheader:true,
                    border:false,
                    modal:true,
                    onLoad:function(){
                         var ckRows = $('#dgDetail').datagrid('getChecked');
                         var body = $('#print').dialog('body');
                         var html = body.html() .replace(/_car_num/g,'w00032').
                         replace(/_car_type/g,'三轮').
                         replace(/_car_owner/g,'宋立夫').
                         replace(/_owner_addr/g,'海南').
                         replace(/_engine_no/g,'12345678').
                         replace(/_frame_no/g,'147852').
                         replace(/_check_passengers/g,'40').
                         replace(/_car_color/g,'红色').
                         replace(/_send_date_year/g,'2018').
                         replace(/_send_date_month/g,'10').
                         replace(/_send_date_day/g,'11');

                         body.html(html);
                    },
                    href:'/PrintTemplate/DrivingLicenseTemplate.html',
                    buttons:'#bb'
       });
     $('#print').dialog('open');
    }
        function initBtn() {
            $('#btnQuery').linkbutton({
                onClick: function () {
                    $('#dgDetail').datagrid('reload');
                }

            });
            $('#btnPrint').linkbutton({
                onClick: function () {
                    var ckRows = $('#dgDetail').datagrid('getChecked');
                   // if (ckRows.length <= 0) {
                   //     $.messager.alert('提示', '请先选中一行需要打印的数据!', 'info');
                   //     return;
                   // }
                    initPrint();
                }

            });
        }
        function initQueryUI() {
            $('#car_type').combobox({
                valueField: 'type_no',
                textField: 'type_name',
            });
            var url = '../../api/PermittedCarTypeApi/QueryAll';
            $.post(url, {}, 'json')
           .success(function (ret) {
               if (ret.success) {
                   $('#car_type').combobox('loadData', ret.data);
               }
           });

        }
        function initGrid() {
            //var height = $(window).height()-5;
            var url = "/api/DriverLicenseApi/queryDrivingPermitByPage";
            $('#dgDetail').datagrid({
                url: url,
                pagination: true,
                pageSize: 10,
                pageList: [10, 20, 30, 40, 50],
                checkOnSelect: true,
                striped: true,
                showHeader: true,
                checkbox: true,
                singleSelect: true,
                rownumbers: true,
                onBeforeLoad: function (param) {
                    var otherParams = getQueryParams();
                    return $.extend(param, otherParams);
                },
                onLoadError: function () { },
                toolbar: '#toolbar',
                width: '100%',
                height: '100%',
                columns: [[
                    { field: 'ck', checkbox: true },
                    { field: 'id_no', title: '驾驶证编号', width: 160, halign: 'center', align: 'left' },
                    { field: 'name', title: '姓名', width: 80, halign: 'center', align: 'left' },
                    {
                        field: 'sex', title: '性别', width: 50, halign: 'center', align: 'left', formatter: function (value, row, index) {
                            if (value == '0') {
                                return '男';
                            }
                            return '女';
                        }
                    },
                    { field: 'car_type', title: '车型', width: 80, halign: 'center', align: 'left' },
                    { field: 'region_name', title: '区域', width: 80, halign: 'center', align: 'left' },
                    { field: 'car_number', title: '车牌号码', width: 100, halign: 'center', align: 'left' },
                    { field: 'start_date', title: '有效期起', width: 180, halign: 'center', align: 'left' },
                    { field: 'end_date', title: '有效期止', width: 180, halign: 'center', align: 'left' },
                ]]
            });
        }
        function initUI() {
            initBtn();
            initQueryUI();
            initGrid();

        }

        $(function () {
            initUI();
        })
    </script>
}